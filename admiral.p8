pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
--game for batleships

function _init()
	mouse.init()
 color=10
	init_game()
	_upd = update_select
	_drw = draw_select
	t = 0
end

function _update()
 _upd()
 t+=1
 
 
 -------test change wind--------
 if btnp(5) then
 	wind = flr(rnd(8)) + 1
 end
 
end

function _draw()
	cls(0)
	map()
	for i = 1, #flot do
		local s=flot[i]
		spr(s.id, s.x*8, s.y*8)
	end
	
	_drw()
	
	----draw wind arrow
	draw_wind()
	--print("wind is ".. wind,16,0)
	drawwndws()

end
-->8
--init
function init_game()
	names = {"boat",										
										"galera",
										"fregat",
										"galeon"										
										}
	flot = {}
	for i = 1, 4 do
		flot[i] = {id = i, 
		x = flr(rnd(15)),
		y = flr(rnd(13)),
		spd = 5,
		hp = 3,
		name = names[i]
		}		
	end	
	sel = 1
	wind = flr(rnd(8)) + 1
	dx8 = {0,1,1,1,0,-1,-1,-1}
	dy8 = {-1,-1,0,1,1,1,0,-1}
	turn_cells = {}
	wndws = {}
	
	--test windows--
	--addwnd(32,32,64,64,{"hello","world"})
end
-->8
--update
function update_game()
		--update_mouse()		
end

function update_select()
	if btnp(1) then
		sel += 1
		if sel > #flot then 
			sel = 1
		end
	elseif btnp(0) then
		sel -= 1
		if sel < 1 then
			sel = #flot
		end
	elseif btnp(4) then
		ship = flot[sel]
		addwnd(32,32,63,48,
		{""..ship.name,
			"-------------",
			"speed.."..ship.spd,
			"health.."..ship.hp,
			"-------------",			
		"select action"})
		calc_turn_cells()
		_upd = update_action_select
		_drw = draw_action_select			
	end
end

function update_action_select()
	if btnp(4) then
		del(wndws,wndws[#wndws])
		_upd = update_select
		_drw = draw_select
	end
end
-->8
--draw
function draw_game()
	
	
	-------draw mouse--------
	--spr(64,mouse_x,mouse_y)
	-------------------------
end

function draw_select()
	local x1 = flot[sel].x*8
	local y1 = flot[sel].y*8
	rect(x1,y1,x1+8,y1+8,9)
end

function draw_wind()
	spr(255-wind+1,0,0)
end

function draw_action_select()		
	for i = 1,8 do
	local rx,ry = flot[sel].x,
															flot[sel].y
		for j = 1,turn_cells[i] do
			rx += dx8[i]
			ry += dy8[i]
			spr(239,rx*8,ry*8)			
		end
	end  
end
-->8
--mouse
mouse = {
  init = function()
    poke(0x5f2d, 1)
  end,
  -- return int:x, int:y, onscreen:bool
  pos = function()
    local x,y = stat(32)-1,stat(33)-1
    return stat(32)-1,stat(33)-1
  end,
  -- return int:button [0..4]
  -- 0 .. no button
  -- 1 .. left
  -- 2 .. right
  -- 4 .. middle
  button = function()
    return stat(34)
  end,
}

function update_mouse()
	mouse_x,mouse_y = mouse.pos()
  mouse_btn = mouse.button()
  
 -- if mouse_btn==1 then color=flr(rnd(15))+1 end
end
-->8
--tools
function calc_turn_cells()
	max_turns = flot[sel].spd	
	turn_cells[wind] = max_turns
	for i = 1,4 do
		max_turns = max(max_turns-1,0)
		local direct1 = wind + i
		local direct2 = wind - i
		if (direct1>8) direct1 -= 8
		if (direct2<1) direct2 += 8
		
		turn_cells[direct1] = max_turns
		turn_cells[direct2] = max_turns
	end
end

function rectfill2(x,y,w,h,c)
	rectfill(x,y,x+w-1,y+h-1,c)
end
-->8
--ui
function addwnd(_x,_y,_w,_h,_txt)
	local w = {x=_x,
												y=_y,
												w=_w,
												h=_h,
												txt=_txt}
	add(wndws,w)
	return w	
end

function drawwndws()	
	for w in all(wndws) do
		local wx,wy,ww,wh,wtxt = w.x,w.y,w.w,w.h,w.txt		
		rectfill2(wx,wy,ww,wh,2)
		rectfill2(wx+1,wy+1,ww-2,wh-2,15)
		rectfill2(wx+2,wy+2,ww-4,wh-4,4)
	
		wx+=4
		wy+=4
		clip(wx,wy,wx+ww-8,wy+wh-8)
		for i = 1,#wtxt do
			print(wtxt[i],wx,wy,15)
			wy+=6
		end	
	end	
end
__gfx__
00000000000000000000000000009888009889880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000988007709888009776700076776700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700006660006777000007676700766676700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000007777006777700077677770776766770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000007777700677770077677767447776640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000900700666666044909000424242440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000042424404009000444242424442424400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004444000444444004444440044444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ddddddddddddddddcccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dcccccccdcccccccccdcccdc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dcccccccdccccccccccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dcccccccdcccc7ccdccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dcccccccdccccccccccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dccdccccdccccccccccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dcccccccdcccccccdccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dcccccccdccccccccccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
fffffffff9333333333333333333339fccfffffff93333333333339fffffffcc3333333300000000000000000000000000000000000000000000000000000000
99999999f9333333333333333333339fcff99999f93333333333339f99999ffc3333333300000000000000000000000000000000000000000000000000000000
33333333f9333333333333333333339fff933333f93333333333339f333339ff3333333300000000000000000000000000000000000000000000000000000000
33333333f9333333333333333333339ff9333333f93333333333339f3333339f3333333300000000000000000000000000000000000000000000000000000000
33333333f9333333333333333333339ff9333333f93333333333339f3333339f3333333300000000000000000000000000000000000000000000000000000000
33333333f9333333333333333333339ff9333333ff933333333339ff3333339f3333333300000000000000000000000000000000000000000000000000000000
33333333f9333333999999993333339ff9333333cff9999999999ffc3333339f3333333300000000000000000000000000000000000000000000000000000000
33333333f9333333ffffffff3333339ff9333333ccffffffffffffcc3333339f3333333300000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66600005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55600005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55566665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66555655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55655555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00567000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00566700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00566600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00566700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00055600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006600660
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000006
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000006
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000006
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000006
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006600660
00000000000000000000000000000000000000000000000000000000000000008888000000000000000000080008100080000000000000000000888800081000
00000000000000000000000000000000000000000000000000000000000000001880000000800000000000810008100018000000000008000000088100881100
00000000000000000000000000000000000000000000000000000000000000001180000008800000000008100008100001800000000008800000081108881110
00000000000000000000000000000000000000000000000000000000000000001018000088888888000081000008100000180000888888880000810100081000
00000000000000000000000000000000000000000000000000000000000000000001800011111111800810000008100000018008111111110008100000081000
00000000000000000000000000000000000000000000000000000000000000000000180001100000888100000888111000001888000001100081000000081000
00000000000000000000000000000000000000000000000000000000000000000000018000100000881000000088110000000188000001000810000000081000
00000000000000000000000000000000000000000000000000000000000000000000001800000000111100000008100000001118000000008100000000081000
__map__
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
